# Redis 配置文件 - 启用持久化

# ==================== 网络配置 ====================
# 绑定地址，0.0.0.0 表示监听所有网络接口
bind 0.0.0.0

# 端口号
port 6379

# 保护模式（生产环境建议开启，需要设置密码）
protected-mode yes

# ==================== 持久化配置 ====================
# RDB 持久化配置（快照）
# save <seconds> <changes>
# 在指定秒数内，如果至少有指定数量的键发生变化，则保存快照
save 900 1      # 900秒内至少1个key变化
save 300 10     # 300秒内至少10个key变化
save 60 10000   # 60秒内至少10000个key变化

# RDB 文件名
dbfilename dump.rdb

# RDB 文件保存目录
dir /data

# 当 Redis 保存 RDB 文件出错时，停止接受写入操作
stop-writes-on-bgsave-error yes

# 压缩 RDB 文件
rdbcompression yes

# 校验 RDB 文件
rdbchecksum yes

# ==================== AOF 持久化配置（推荐）====================
# 启用 AOF 持久化（更可靠，推荐生产环境使用）
appendonly yes

# AOF 文件名
appendfilename "appendonly.aof"

# AOF 同步策略
# always: 每个写命令都同步（最安全，但性能最低）
# everysec: 每秒同步一次（推荐，平衡性能和安全）
# no: 由操作系统决定何时同步（最快，但可能丢失数据）
appendfsync everysec

# AOF 重写时是否继续同步
no-appendfsync-on-rewrite no

# AOF 自动重写触发条件
# 当前 AOF 文件大小是上次重写后大小的 100% 时触发重写
auto-aof-rewrite-percentage 100
# AOF 文件最小重写大小（64MB）
auto-aof-rewrite-min-size 64mb

# ==================== 内存管理 ====================
# 最大内存（根据实际需求调整，0 表示不限制）
# maxmemory 2gb

# 内存淘汰策略（当达到最大内存时）
# allkeys-lru: 从所有键中淘汰最近最少使用的键
# volatile-lru: 从设置了过期时间的键中淘汰最近最少使用的键
# allkeys-random: 从所有键中随机淘汰
# volatile-random: 从设置了过期时间的键中随机淘汰
# volatile-ttl: 从设置了过期时间的键中淘汰即将过期的键
# noeviction: 不淘汰，返回错误（默认）
# maxmemory-policy allkeys-lru

# ==================== 日志配置 ====================
# 日志级别
loglevel notice

# ==================== 其他配置 ====================
# 数据库数量
databases 16

# 客户端超时时间（秒）
timeout 0

# TCP keepalive
tcp-keepalive 300

